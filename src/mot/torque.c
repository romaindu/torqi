/*
 * torque.c
 *
 * @author: Romain Durand
*/

#include "torque.h"

#include "controller.h"

static struct pi_controller pic[2];

static int16_t sine_lut[80] = {
    0, 2056, 4100, 6119, 8100, 10031, 11900, 13696, 15407, 17024, 18535, 19932,
    21207, 22350, 23356, 24218, 24930, 25489, 25890, 26132, 26213, 26132, 25890,
    25489, 24930, 24218, 23356, 22350, 21207, 19932, 18535, 17024, 15407, 13696,
    11900, 10031, 8100, 6119, 4100, 2056, 0, -2056, -4100, -6119, -8100, -10031,
    -11900, -13696, -15407, -17024, -18535, -19932, -21207, -22350, -23356,
    -24218, -24930, -25489, -25890, -26132, -26213, -26132, -25890, -25489,
    -24930, -24218, -23356, -22350, -21207, -19932, -18535, -17024, -15407,
    -13696, -11900, -10031, -8100, -6119, -4100, -2056
};

int32_t torque_on_adc_sample(int32_t ph, int32_t adc)
{
    int32_t trgt, err;

    return controller_compute(&pic[ph], err);
}
